require 'rake/clean.rb'
require 'rake/testtask.rb'


load '../../../antconfig.rb'


CFLAGS="-I../../../ext/basic "+$CONFIG["CFLAGS"]+" "+$CONFIG["INCLUDEPATH"]
#`sdl-config --cflags`.chomp

task :default=>['test.so'] do
end

task 'test.so' => ["test.oo","swig.oo","../../../ext/basic/ag_string.oo"] do |t|
	sh "g++ -shared -o #{t.name} #{t.prerequisites}"
end

rule '.oo'=>'.cc' do |t|
	sh "g++ -o #{t.name} -c #{t.prerequisites} #{CFLAGS}"
end

rule 'swig.cc' => lambda{[]} do |t|
	sh "swig -Wall -c++ -ruby -DAGEXPORT -I.. -I../../../ext/game -I../../../ext/basic -o #{t.name} #{t.name.gsub("swig.cc","interface.i")}"
end

task 'entity.so' => 'entity_swig.cc' do
end

Rake::TestTask.new do |t|
	t.libs << "test.so"
	t.test_files = FileList['test*.rb']
	t.verbose = true
end

CLEAN << Dir["*swig.cc"]+Dir["*.oo"]