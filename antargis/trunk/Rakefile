require File.join(File.split(__FILE__)[0],'rookey','tasks.rb')
require 'spec/rake/spectask'

# basic version

#inits=Dir["ext/*/init.cc"].grep(/AG_Init_/).map{|f|"AG_Init_libantargis"+f.split("/")[1]}
#pp inits
#exit
inits=[
  "external",
  "basic",
  "math",
  "video",
  "sound",
  "gui",
  "3dengine",
  "game"
      ].map{|f|"AG_Init_libantargis"+f}
lib=Rookey::ruby_ext("antargis",Dir["ext/*/*.cc"]+Dir["ext/*/*.c"]+Dir["ext/*/*.h"]+Dir["ext/*/templates.i"],inits)

ts=Rookey::compile(Dir["main/starter.cc"])
main=Rookey::link_exe("starter",ts)


task :default=>[lib,main] do
  puts "Done."
end


alias :oldSystem :system
def system(cmd)
  #puts Dir.pwd
  if cmd=~/ruby .*/
    cmd.gsub!(/^ruby/,"./starter")
  end
  #puts cmd
  oldSystem(cmd)
end


# rspec
Spec::Rake::SpecTask.new(:spec=>:default) do |t|
  t.spec_files = FileList['ruby/**/spec_*.rb'].map{|f|File.expand_path(f)}
  t.warning = true
  t.rcov = true
  t.spec_opts=["--format html:"+File.expand_path("spec_output.html")]
end